# 🛠️ 开发踩坑与避坑指南

> 本文档记录开发过程中遇到的问题和解决方案，持续更新。

---

## [2026-02-09] 技术选型：FFmpegKit 已退役

### 现象描述
原本计划使用 `ffmpeg_kit_flutter` 官方插件。

### 根本原因
FFmpegKit 官方团队已宣布退役，GitHub 仓库归档，不再维护。

### 解决方案
改用社区维护版 `ffmpeg_kit_flutter_new`，该插件持续更新并兼容最新 Flutter 版本。

### 避坑建议
- 使用第三方库前，先检查其维护状态
- 优先选择社区活跃的分支/替代品

---

## [2026-02-09] 无损剪切的关键帧限制

### 现象描述
使用 `-c copy` 剪切视频时，起始时间不精确，可能比设定的时间早 1-2 秒。

### 根本原因
视频编码原理：只能在关键帧（I-frame）处切割。如果你设定的时间点不是关键帧，FFmpeg 会自动回退到最近的关键帧。

### 解决方案
这是无损剪切的固有限制，**无法规避**。用户需理解并接受。

### 避坑建议
- 在 UI 上明确提示用户"切点可能存在 1-2 秒偏差"
- 如果需要精确到帧，必须使用重编码模式（会有画质损失）

---

## [2026-02-09] 无损合并要求格式一致

### 现象描述
合并两个视频时，FFmpeg 报错或输出异常。

### 根本原因
无损合并（concat demuxer）要求所有视频片段：
- 分辨率相同
- 编码器相同（如都是 H.264）
- 音频采样率相同

### 解决方案
1. 在 UI 提示用户"请确保视频格式一致"
2. 如格式不一致，需先转码统一格式后再合并

### 避坑建议
- 合并手机拍摄的视频通常没问题（格式一致）
- 合并不同来源的视频容易出问题

---

## [2026-02-09] FFmpeg 日志输出调试

### 现象描述
FFmpeg 命令执行失败，但不知道具体原因。

### 解决方案
在代码中添加日志输出：
```dart
final logs = await session.getAllLogsAsString();
print('FFmpeg 日志: $logs');
```

### 避坑建议
- 开发阶段保留详细日志
- 正式发布可以精简日志输出
